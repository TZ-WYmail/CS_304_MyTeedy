# 文件名：.github/workflows/maven.yml

# 工作流名称
name: Java CI with Maven

# 触发工作流的事件类型
on:
  # 推送代码到任何分支
  push:
    branches: ["*"]
  # 拉取请求
  pull_request:
    branches: ["*"]
  # 手动触发
  workflow_dispatch:

# 定义工作流中的作业
jobs:
  # 定义一个名为 "build" 的作业
  build:
    # 指定运行作业的操作系统环境
    runs-on: ubuntu-latest

    # 定义作业的步骤
    steps:
      # 第一步：检出代码
      - name: Checkout code
        uses: actions/checkout@v3

      # 第二步：设置 JDK 11
      - name: Set up JDK 11
        uses: actions/setup-java@v3
        with:
          java-version: '11'
          distribution: 'temurin'
          cache: maven

      # 第三步：使用 Maven 构建项目
      - name: Build with Maven
        run: mvn -B -DskipTests package --file pom.xml

      # 第四步：运行测试（可选）
      - name: Run Tests
        run: mvn test

      # 第五步：生成测试覆盖率报告（可选）
      - name: Generate Test Coverage Report
        run: mvn jacoco:report

      # 第六步：上传测试报告（可选）
      - name: Upload Test Report
        uses: actions/upload-artifact@v3
        with:
          name: test-report
          path: target/surefire-reports/**

      # 第七步：上传测试覆盖率报告（可选）
      - name: Upload Coverage Report
        uses: actions/upload-artifact@v3
        with:
          name: coverage-report
          path: target/site/jacoco/**
